1. generate 

istioctl manifest generate \
--set profile=demo \
--set values.gateways.istio-ingressgateway.sds.enabled=true \
--set values.global.k8sIngress.enabled=true \
--set values.global.k8sIngress.enableHttps=true \
--set values.global.k8sIngress.gatewayName=ingressgateway \ 
--set values.gateways.istio-egressgateway.enabled=false \
--set global.multiCluster.enabled=false



2. apply the above config

manifest apply

-- might need to manifest apply twice, to ensure the crd's are created.

3. 

apply the whole thing



more todo:
- apply (gcp) dns, create an LB that targets the gateway and badaboom... need the gateway to go through the ingress?.
  - ensure the grpc-backend is reachable via the gateway
- setup crdb to be reachable via the gateway: https://istio.io/docs/reference/config/networking/gateway/
  - how to do this with statefulsets?????
    - maybe adding a lua filter https://istio.io/docs/reference/config/networking/envoy-filter/
    - ( NOT)easy peezy: 
      - we set a virtual host with a suffix match, then we add a request_headers_to_add
        https://github.com/envoyproxy/envoy/blob/master/api/envoy/api/v2/route/route_components.proto
      - then we have no way to get the prefix.... :/
- test to see if messing with dns fucks up istio routing...
  - https://istio.io/docs/setup/install/multicluster/gateways/




notes
================================================================================

https://github.com/cockroachdb/cockroach/issues/42741

we needa set the cert values if we want to use sds https://istio.io/docs/reference/config/networking/gateway/
... do we also need to add the mounts?


looks like i can configure mtls with upstream/downstream: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/ssl

next question(s):
- how do i connect via sds or cert manager?
  - https://www.envoyproxy.io/docs/envoy/latest/configuration/security/secret#examples-two-sds-server

how can i configure this in istio/k8s

k8s: https://github.com/honeycombio/examples/blob/master/kubernetes-envoy-tracing/demo.yaml


maybe also this?